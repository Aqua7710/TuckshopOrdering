@model OrderViewModel

@{
	ViewData["Title"] = "Index";
}

<h1>Orders</h1>

<div style="display: flex; gap: 10px; margin-bottom: 10px;">
	<form asp-action="Index" method="get">
		<p>
			Filter: <input type="text" name="searchString" />
		</p>
	</form>
	<form asp-action="Index"><button class="returnBtn">Return</button></form>
</div>

<div class="menu">
	<h1>Todays Orders</h1>
	@foreach (var item in Model.Orders)
	{
		<div class="card" style="width: 18rem;">
			<div class="dropdown">
				<a class="btn btn-secondary dropdown-toggle editBtn" href="#" role="button" id="editDropDown" data-bs-toggle="dropdown" aria-expanded="false" style="z-index: 5;">
					Modify
				</a>
				<ul class="dropdown-menu" aria-labelledby="editDropDown">
					<li><a asp-action="Edit" asp-route-id="@item.OrderID" class="dropdown-item">Edit</a></li>
					<li><a asp-action="Details" asp-route-id="@item.OrderID" class="dropdown-item">Details</a></li>
					<li><a asp-action="Delete" asp-route-id="@item.OrderID" class="dropdown-item">Delete</a></li>
				</ul>
			</div>
			<div class="card-body">
				<h3 class="card-title">@item.studentName</h3>
				<h5 class="card-subtitle">Rm @item.roomNumber</h5>
				@if (Model.FoodOrders.ContainsKey(item.OrderID))
				{
					foreach (var foodItem in Model.FoodOrders[item.OrderID])
					{
						<div class="orderItem">
							<p class="flexItem" style="">@foodItem.quantity x @foodItem.Menu.foodName</p> <!--Item quantity and item name-->
							@{
								decimal total = foodItem.Menu.price * foodItem.quantity;
							}
							<p>$@total</p>
						</div>
					}
				}

				@{
					decimal grandTotal = Model.FoodOrders[item.OrderID].Sum(foodOrder => foodOrder.Menu.price * foodOrder.quantity);
				}

				<p class="orderItem">Total price: $@grandTotal</p>
				<div class="line" style="padding: 0;">
					<hr class="solid">
				</div>
				<p style="font-weight: bold; text-align: left;">Collection Date: <span style="font-weight: normal">@item.PickupDate</span></p>
				<p style="font-weight: bold; text-align: left;">Order Date: <span style="font-weight: normal">@item.OrderDate</span></p>
				<div class="gridBtns" style="padding: 0;">
					<button class="gridBtnsItem">Edit</button>
					<button class="gridBtnsItem"><a asp-action="Delete" asp-route-id="@item.OrderID" class="dropdown-item">Delete</a></button>
					<button class="gridBtnsItem">Print</button>
				</div>
			</div>
		</div>
	}
</div>
